<!DOCTYPE html>
<html lang="ru">
  <head>
    <meta charset="UTF-8" />
    <title>TODO</title>
  </head>
  <body>
    <h1>TODO список</h1>

    <form id="taskForm">
      <input type="text" id="title" placeholder="Название задачи" required />
      <button type="submit">Добавить</button>
    </form>

    <h2>Задачи:</h2>
    <div id="tasks"></div>

    <script>
      const API_URL = "http://127.0.0.1:5000/tasks";

      async function loadTasks() {
        const res = await fetch(API_URL);
        const tasks = await res.json();

        const tasksContainer = document.getElementById("tasks");
        tasksContainer.innerHTML = "";

        tasks.forEach((task) => {
          const div = document.createElement("div");
          div.innerHTML = `
        <span>${task.title}</span>
        <div>
          <button onclick="toggleDone(${task.id}, ${task.done})">
            ${task.done ? "↩" : "✔"}
          </button>
          <button onclick="deleteTask(${task.id})">❌</button>
        </div>
      `;
          tasksContainer.appendChild(div);
        });
      }

      document
        .getElementById("taskForm")
        .addEventListener("submit", async (e) => {
          e.preventDefault();

          const title = document.getElementById("title").value;

          await fetch(API_URL, {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ title }),
          });

          document.getElementById("title").value = "";
          loadTasks();
        });

      async function toggleDone(id, done) {
        await fetch(`${API_URL}/${id}`, {
          method: "PUT",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ done: !done }),
        });
        loadTasks();
      }

      async function deleteTask(id) {
        await fetch(`${API_URL}/${id}`, {
          method: "DELETE",
        });
        loadTasks();
      }

      loadTasks();
    </script>
  </body>
</html>
